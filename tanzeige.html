<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trainingszeiten – Übersicht</title>
  <style>
    :root{ --bg:#000; --text:#fff; --muted:#aaa; --field:#111; --border:#2a2a2a; }
    *{ box-sizing:border-box; }
    body{
      margin:0; background:#000; color:#fff; font-family:Arial, Helvetica, sans-serif;
      -webkit-font-smoothing:antialiased; min-height:100vh; display:flex; flex-direction:column;
    }
    .wrap{ width:100%; max-width:960px; margin:0 auto; padding:20px 16px 60px; }
    .top-bar{ display:flex; justify-content:center; align-items:center; margin-bottom:16px; }
    h1{ margin:0; font-size:26px; }
    .status{ color:var(--muted); font-size:13px; text-align:center; margin:6px 0 14px; }

    .day{ margin-top:18px; border-top:1px solid var(--border); padding-top:14px; }
    .day h2{ margin:0 0 8px; font-size:18px; color:#eaeaea; letter-spacing:.2px; }

    /* Spalten: What | Time | 6 Trainer */
    .slot{
      display:grid;
      grid-template-columns: 240px 140px repeat(6, minmax(120px,1fr));
      gap:10px; align-items:center; padding:10px 0; border-bottom:1px dashed #1c1c1c;
    }
    .what{ color:#eaeaea; font-size:15px; }
    .time{ font-weight:bold; letter-spacing:.2px; }
    .names{ display:contents; }
    .name{
      background:var(--field); color:#fff; border:1px solid var(--border);
      border-radius:8px; padding:10px 12px; font-size:15px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .placeholder{ color:#777; font-style:italic; }

    /* Mobil: What & Time oben, Trainer darunter im Grid */
    @media (max-width:980px){
      .slot{ grid-template-columns: 1fr 120px; grid-auto-rows:auto; align-items:start; }
      .what{ grid-column:1 / 2; }
      .time{ grid-column:2 / 3; text-align:right; }
      .names{
        grid-column:1 / -1;
        display:grid; grid-template-columns:repeat(3, 1fr); gap:8px; margin-top:8px;
      }
    }
    @media (max-width:620px){
      .names{ grid-template-columns:repeat(2, 1fr); }
    }
    @media (max-width:420px){
      .names{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top-bar"><h1>Trainingszeiten – Übersicht</h1></div>
    <div id="status" class="status">Lade Daten…</div>
    <div id="schedule"></div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

  <script>
    // ---------- Firebase Init ----------
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey: "AIzaSyDNY_Laa_eeiQmC6rcHWRNn_P-qdA7vzdw",
        authDomain: "wt-plus-login.firebaseapp.com",
        databaseURL: "https://wt-plus-login-default-rtdb.firebaseio.com",
        projectId: "wt-plus-login",
        storageBucket: "wt-plus-login.firebasestorage.app",
        messagingSenderId: "775441256129",
        appId: "1:775441256129:web:64b962f72181248ef04e40"
      });
    }
    const db = firebase.firestore();

    // ---------- Aufbau ----------
    // Pro Zeitfenster auch "what" (Beschreibung)
    const SLOTS = [
      { day: "Montag", slots: [
      { time: "17:30-18:15", what: "Jugendliche 8-12 Jahre" },
        { time: "19:30-21:00", what: "Erwachsene ab 13 Jahre" },
      ]},
      { day: "Mittwoch", slots: [
        { time: "16:30-17:15", what: "Minis ab 4 Jahre" },
        { time: "17:30-18:15", what: "Kids 5-7 Jahre" },
        { time: "18:30-19:15", what: "Jugendliche 8-12 Jahre" },
        { time: "19:30-21:00", what: "Erwachsene ab 13 Jahre" },
      ]},
      { day: "Donnerstag", slots: [
        { time: "16:30-17:15", what: "Minis ab 4 Jahre" },
        { time: "17:30-18:15", what: "Kids 5-7 Jahre" },
        { time: "18:45-19:45", what: "ChiKung" },
      ]},
    ];

    const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");

    const root = document.getElementById('schedule');
    const statusEl = document.getElementById('status');

    // Optional: ?school=MASTER → liest trainingszeiten/MASTER statt /belegung
    const params = new URLSearchParams(location.search);
    const schoolDoc = params.get('school') || 'belegung';

    function renderSkeleton(){
      root.innerHTML="";
      for(const group of SLOTS){
        const day=document.createElement('div');
        day.className='day';
        day.innerHTML=`<h2>${group.day}</h2>`;
        for(const slot of group.slots){
          const row=document.createElement('div');
          row.className='slot';
          row.setAttribute('data-day', group.day);
          row.setAttribute('data-time', slot.time); // stabil für IDs
          row.innerHTML=`
            <div class="what">${slot.what || ""}</div>
            <div class="time">${slot.time}</div>
            <div class="names">
              <div class="name placeholder">Trainer 1</div>
              <div class="name placeholder">Trainer 2</div>
              <div class="name placeholder">Trainer 3</div>
              <div class="name placeholder">Trainer 4</div>
              <div class="name placeholder">Trainer 5</div>
              <div class="name placeholder">Trainer 6</div>
            </div>`;
          day.appendChild(row);
        }
        root.appendChild(day);
      }
    }

    // Füllt auf 6 Einträge auf (Kompatibilität mit alten 3er-Arrays)
    function pad6(arr){
      const out = Array.isArray(arr) ? arr.slice(0,6) : [];
      while(out.length<6) out.push("");
      return out;
    }

    function applyValues(data){
      const map = {};
      for(const [key, val] of Object.entries(data||{})){
        map[key] = pad6(val);
      }
      document.querySelectorAll('.day').forEach(day=>{
        const dname = day.querySelector('h2').textContent;
        day.querySelectorAll('.slot').forEach(row=>{
          const time = row.getAttribute('data-time');
          const id = `${slug(dname)}__${slug(time)}`;
          const arr = map[id] || pad6([]);
          const boxes = row.querySelectorAll('.name');
          boxes.forEach((box,i)=>{
            const v = arr[i] || "";
            box.textContent = v ? v : `Trainer ${i+1}`;
            box.classList.toggle('placeholder', !v);
          });
        });
      });
    }

    // Initiales Layout
    renderSkeleton();

    // Live-Listener
    db.collection('trainingszeiten').doc(schoolDoc).onSnapshot(
      snap=>{
        if (!snap.exists) {
          statusEl.textContent = `Kein Eintrag gefunden (Dokument trainingszeiten/${schoolDoc}).`;
          return;
        }
        statusEl.textContent = "";
        applyValues(snap.data());
      },
      err=>{
        console.error(err);
        statusEl.textContent = (err && err.code === 'permission-denied')
          ? "Keine Leseberechtigung – passe Firestore-Regeln an (allow read: if true)."
          : "Fehler beim Laden.";
      }
    );
  </script>
</body>
</html>
