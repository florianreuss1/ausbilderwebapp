<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trainingszeiten – Übersicht</title>
  <style>
    :root{ --bg:#000; --text:#fff; --muted:#aaa; --field:#111; --border:#2a2a2a; }
    *{ box-sizing:border-box; }
    body{
      margin:0; background:#000; color:#fff; font-family:Arial, Helvetica, sans-serif;
      -webkit-font-smoothing:antialiased; min-height:100vh; display:flex; flex-direction:column;
    }
    .wrap{ width:100%; max-width:960px; margin:0 auto; padding:20px 16px 60px; }
    .top-bar{ display:flex; justify-content:center; align-items:center; margin-bottom:16px; }
    h1{ margin:0; font-size:26px; }
    .status{ color:var(--muted); font-size:13px; text-align:center; margin:6px 0 14px; }

    .day{ margin-top:18px; border-top:1px solid var(--border); padding-top:14px; }
    .day h2{ margin:0 0 8px; font-size:18px; color:#eaeaea; letter-spacing:.2px; }

    .slot{
      display:grid; grid-template-columns: 160px repeat(3, minmax(120px,1fr));
      gap:10px; align-items:center; padding:10px 0; border-bottom:1px dashed #1c1c1c;
    }
    .time{ font-weight:bold; letter-spacing:.2px; }
    .names{ display:contents; }
    .name{
      background:var(--field); color:#fff; border:1px solid var(--border);
      border-radius:8px; padding:10px 12px; font-size:15px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .placeholder{ color:#777; font-style:italic; }
    @media (max-width:720px){
      .slot{ grid-template-columns: 120px 1fr 1fr; grid-auto-rows:auto; }
      .slot .time{ grid-column:1 / 2; }
      .slot .names{ grid-column:2 / -1; display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; }
    }
    @media (max-width:460px){
      .slot .names{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top-bar"><h1>Trainingszeiten – Übersicht</h1></div>
    <div id="status" class="status">Lade Daten…</div>
    <div id="schedule"></div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

  <script>
    // ---------- Firebase Init ----------
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey: "AIzaSyDNY_Laa_eeiQmC6rcHWRNn_P-qdA7vzdw",
        authDomain: "wt-plus-login.firebaseapp.com",
        databaseURL: "https://wt-plus-login-default-rtdb.firebaseio.com",
        projectId: "wt-plus-login",
        storageBucket: "wt-plus-login.firebasestorage.app",
        messagingSenderId: "775441256129",
        appId: "1:775441256129:web:64b962f72181248ef04e40"
      });
    }
    const db = firebase.firestore();

    // ---------- Aufbau ----------
    const SLOTS = [
      { day: "Montag",     times: ["17:30-18:15", "19:30-21:00"] },
      { day: "Mittwoch",   times: ["16:30-17:15", "17:30-18:15", "18:30-19:15", "19:30-21:00"] },
      { day: "Donnerstag", times: ["16:30-17:15", "17:30-18:15", "18:45-20:45"] }
    ];
    const slug = s => s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");

    const root = document.getElementById('schedule');
    const statusEl = document.getElementById('status');

    // Optional: ?school=MASTER → liest trainingszeiten/MASTER statt /belegung
    const params = new URLSearchParams(location.search);
    const schoolDoc = params.get('school') || 'belegung';

    function renderSkeleton(){
      root.innerHTML="";
      for(const group of SLOTS){
        const day=document.createElement('div');
        day.className='day';
        day.innerHTML=`<h2>${group.day}</h2>`;
        for(const t of group.times){
          const row=document.createElement('div');
          row.className='slot';
          row.innerHTML=`
            <div class="time">${t}</div>
            <div class="names">
              <div class="name placeholder">Trainer 1</div>
              <div class="name placeholder">Trainer 2</div>
              <div class="name placeholder">Trainer 3</div>
            </div>`;
          day.appendChild(row);
        }
        root.appendChild(day);
      }
    }

    function applyValues(data){
      const map = {};
      for(const [key, val] of Object.entries(data||{})){
        map[key] = Array.isArray(val) ? val : ["","",""];
      }
      document.querySelectorAll('.day').forEach(day=>{
        const dname = day.querySelector('h2').textContent;
        day.querySelectorAll('.slot').forEach(row=>{
          const time = row.querySelector('.time').textContent;
          const id = `${slug(dname)}__${slug(time)}`;
          const arr = map[id] || ["","",""];
          const boxes = row.querySelectorAll('.name');
          arr.forEach((v,i)=>{
            boxes[i].textContent = v || "";
            boxes[i].classList.toggle('placeholder', !v);
            if(!v) boxes[i].textContent = `Trainer ${i+1}`;
          });
        });
      });
    }

    // Initiales Layout
    renderSkeleton();

    // Live-Listener
    db.collection('trainingszeiten').doc(schoolDoc).onSnapshot(
      snap=>{
        if (!snap.exists) {
          statusEl.textContent = `Kein Eintrag gefunden (Dokument trainingszeiten/${schoolDoc}).`;
          return;
        }
        statusEl.textContent = "";
        applyValues(snap.data());
      },
      err=>{
        console.error(err);
        statusEl.textContent = (err && err.code === 'permission-denied')
          ? "Keine Leseberechtigung – passe Firestore-Regeln an (allow read: if true)."
          : "Fehler beim Laden.";
      }
    );
  </script>
</body>
</html>
